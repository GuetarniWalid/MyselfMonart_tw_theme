{% comment %}
  Reusable generic filter section
  Renders any filter checkboxes from Search & Discovery

  Parameters:
  - id_prefix: String - Prefix for checkbox IDs (e.g., 'filter-1-')
  - filter: Object - The filter object from collection.filters
  - filter_index: Number - Index of the filter for creating unique classes

  Usage:
  {% render 'filter-generic-section', id_prefix: 'filter-1-', filter: filter, filter_index: 1 %}
{% endcomment %}

{% if filter %}
<div class="py-4 {% unless forloop.first %}border-t border-main{% endunless %}">
  <details class="group" {% if filter_index <= 2 %}open{% endif %}>
    <summary class="sticky top-0 z-10 bg-secondary flex justify-between items-center cursor-pointer list-none select-none py-2 px-4">
      <span class="font-semibold text-sm font-heading">{{ filter.label }}</span>
      <span class="group-open:rotate-180 transition-transform duration-200">
        {% render 'tw-icon-caret', width: "12" %}
      </span>
    </summary>

    <ul class="pt-3 pb-4 px-4 flex flex-col gap-4 max-h-[300px] overflow-y-auto scrollbar list-none">
      {% for filter_value in filter.values %}
        {% assign value_label = filter_value.label %}
        {% assign value_value = filter_value.value %}
        {% assign value_count = filter_value.count %}

        {%- comment -%} Only show values with at least 1 matching product {%- endcomment -%}
        {% if value_count > 0 %}

        {%- comment -%} Show first 8 items, hide rest {%- endcomment -%}
        {% assign value_index = forloop.index0 %}
        {% assign value_handleized = value_label | handleize %}
        {% assign checkbox_id_value = id_prefix | append: value_handleized %}
        {% assign checkbox_label_value = value_label | append: ' (' | append: value_count | append: ')' %}
        {% assign extra_class = 'js-extra-filter-' | append: filter_index %}

        <li class="{% if value_index >= 8 %}hidden {{ extra_class }}{% endif %}">
          {% render 'custom-checkbox',
            checkbox_id: checkbox_id_value,
            checkbox_name: 'filter-' | append: filter_index,
            checkbox_value: value_value,
            checkbox_label: checkbox_label_value,
            data_filter_param: filter.param_name %}
        </li>

        {% endif %}
      {% endfor %}
    </ul>

    {%- comment -%} Show more button (only if more than 8 items) {%- endcomment -%}
    {% assign total_values = filter.values | size %}
    {% if total_values > 8 %}
      {% assign extra_class = 'js-extra-filter-' | append: filter_index %}
      <button
        type="button"
        class="text-sm text-main-70 hover:text-main mt-4 cursor-pointer underline underline-offset-4 decoration-1 hover:decoration-2 px-4"
        onclick="
          const extraItems = this.closest('details').querySelectorAll('.{{ extra_class }}');
          const isShowing = extraItems[0].classList.contains('hidden');
          extraItems.forEach(item => item.classList.toggle('hidden'));
          this.textContent = isShowing ? '{{ 'sections.filter_drawer.show_less' | t }}' : '{{ 'sections.filter_drawer.show_more' | t }}';
        ">
        {{ 'sections.filter_drawer.show_more' | t }}
      </button>
    {% endif %}
  </details>
</div>
{% endif %}
