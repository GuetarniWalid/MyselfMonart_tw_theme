{% comment %}
  Accepts:
  - product: {Object} product object.
  - block: {Object} passing the block information.
{% endcomment %}

{%- unless product.has_only_default_variant -%}
    <div class="mb-6">
        {%- for option in product.options_with_values -%}
            <div class="pt-3 px-1 mx-4">
                {% if option.position == 1 %}
                    <button class="underline cursor-pointer hover:no-underline mb-3 flex items-center gap-2" onclick="document.getElementById('size-guide-popup').showModal()">
                        <span class="flex items-center justify-center w-5 h-5 rounded-full border border-main flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 15 15">
                                <path fill="currentColor" d="M7.5 1C6.7 1 6 1.7 6 2.5S6.7 4 7.5 4S9 3.3 9 2.5S8.3 1 7.5 1M4 5v1s2 0 2 2v2c0 2-2 2-2 2v1h7v-1s-2 0-2-2V6c0-.5-.5-1-1-1z"></path>
                            </svg>
                        </span>
                        <span>{{ 'sections.main_product.variant_picker.size_guide' | t }}</span>
                    </button>
                {% elsif option.position == 2 %}
                    <button class="underline cursor-pointer hover:no-underline mb-3 flex items-center gap-2" onclick="document.getElementById('border-guide-popup').showModal()">
                        <span class="flex items-center justify-center w-5 h-5 rounded-full border border-main flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 15 15">
                                <path fill="currentColor" d="M7.5 1C6.7 1 6 1.7 6 2.5S6.7 4 7.5 4S9 3.3 9 2.5S8.3 1 7.5 1M4 5v1s2 0 2 2v2c0 2-2 2-2 2v1h7v-1s-2 0-2-2V6c0-.5-.5-1-1-1z"></path>
                            </svg>
                        </span>
                        <span id="selected-border-name">
                            {%- for value in option.values -%}
                                {%- if value.selected -%}{{ value }}{%- endif -%}
                            {%- endfor -%}
                        </span>
                    </button>
                {% elsif option.position == 3 %}
                    <button class="underline cursor-pointer hover:no-underline mb-3 flex items-center gap-2" onclick="document.getElementById('frame-guide-popup').showModal()">
                        <span class="flex items-center justify-center w-5 h-5 rounded-full border border-main flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 15 15">
                                <path fill="currentColor" d="M7.5 1C6.7 1 6 1.7 6 2.5S6.7 4 7.5 4S9 3.3 9 2.5S8.3 1 7.5 1M4 5v1s2 0 2 2v2c0 2-2 2-2 2v1h7v-1s-2 0-2-2V6c0-.5-.5-1-1-1z"></path>
                            </svg>
                        </span>
                        <span id="selected-frame-name">
                            {%- for value in option.values -%}
                                {%- if value.selected -%}{{ value }}{%- endif -%}
                            {%- endfor -%}
                        </span>
                    </button>
                {% endif %}
            </div>
            <div class="relative">
                <div class="scroll-arrow scroll-arrow-right absolute right-0 top-0 bottom-3 w-12 bg-gradient-to-l from-secondary via-secondary via-60% to-transparent flex items-center justify-center z-10 transition-opacity duration-200">
                    <button type="button" class="w-8 h-8 flex items-center justify-end">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="variant-options-container flex gap-3 overflow-x-auto font-heading text-sm font-semibold py-4 px-5 scrollbar-thin scrollbar-thumb-main-30 scrollbar-track-transparent scroll-smooth">
            {%- for value in option.values -%}
                {% if value.available %}
                    <painting-variant-picker data-option="option{{ option.position }}" data-option-value="{{ value }}" data-price-pattern="{{ product.price_min | money }}" data-variant-price="{{ value.price | money }}" data-initially-available="{{ value.available }}" class="flex-shrink-0">
                        <label class="cursor-pointer transition-opacity duration-200">
                            <input
                                type="radio"
                                name="option{{ option.position }}"
                                value="{{ value }}"
                                class="peer hidden"
                                {% if value.selected %}checked{% endif %}
                                data-variant-option>
                            {% if option.position == 1 %}
                                <span class="block px-3 py-2 font-normal rounded-full bg-secondary peer-checked:bg-main peer-checked:text-secondary text-main transition-all duration-100">
                                    {{ value }}
                                </span>
                            {% elsif option.position == 2 %}
                                {%- comment -%} Find the matching border metaobject for this value {%- endcomment -%}
                                {%- assign border_option = null -%}
                                {%- for border in product.metafields.painting_options.borders.value -%}
                                    {%- if border.name == value -%}
                                        {%- assign border_option = border -%}
                                        {%- break -%}
                                    {%- endif -%}
                                {%- endfor -%}

                                {%- if border_option and border_option.radio.value.media.value.src -%}
                                    <span class="block rounded-full overflow-hidden w-[60px] h-[60px] transition-all duration-100 peer-checked:outline peer-checked:outline-1 peer-checked:outline-main peer-checked:outline-offset-2">
                                        <img
                                            src="{{ border_option.radio.value.media.value.src | image_url: width: 60 }}"
                                            alt="{{ border_option.radio.value.media.value.alt | escape }}"
                                            width="60"
                                            height="60"
                                            loading="lazy"
                                            class="object-cover">
                                    </span>
                                {%- endif -%}
                            {% elsif option.position == 3 %}
                                {%- comment -%} Find the matching frame metaobject for this value {%- endcomment -%}
                                {%- assign frame_option = null -%}
                                {%- assign is_first_frame = false -%}
                                {%- for frame in product.metafields.painting_options.frames_canvas.value -%}
                                    {%- if frame.name == value -%}
                                        {%- assign frame_option = frame -%}
                                        {%- if forloop.first -%}
                                            {%- assign is_first_frame = true -%}
                                        {%- endif -%}
                                        {%- break -%}
                                    {%- endif -%}
                                {%- endfor -%}

                                {%- if is_first_frame -%}
                                    <span class="flex items-center justify-center w-[60px] h-[60px] rounded-full transition-all duration-100 peer-checked:outline peer-checked:outline-1 peer-checked:outline-main peer-checked:outline-offset-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 42 42" class="text-main">
                                            <circle class="fill-main-10" cx="21" cy="21" r="20"/>
                                            <line x1="34" y1="8" x2="8" y2="34" stroke="currentColor" stroke-width="1" stroke-linecap="round"/>
                                        </svg>
                                    </span>
                                {%- elsif frame_option and frame_option.radio.value.media.value.src -%}
                                    <span class="block rounded-full overflow-hidden w-[60px] h-[60px] transition-all duration-100 peer-checked:outline peer-checked:outline-1 peer-checked:outline-main peer-checked:outline-offset-2">
                                        <img
                                            src="{{ frame_option.radio.value.media.value.src | image_url: width: 60 }}"
                                            alt="{{ frame_option.radio.value.media.value.alt | escape }}"
                                            width="60"
                                            height="60"
                                            loading="lazy"
                                            class="object-cover">
                                    </span>
                                {%- endif -%}
                            {% else %}
                                <span class="block">{{ value }}</span>
                            {% endif %}
                        </label>
                    </painting-variant-picker>
                {% endif %}
            {% endfor %}
                </div>
            </div>
            {% if option.position == 3 %}
                <div id="no-frames-message" class="hidden px-3 pt-2 text-sm text-main-70 italic ml-4">
                    {{ 'sections.main_product.variant_picker.no_frames_available' | t }}
                </div>
            {% endif %}
            {% unless forloop.last %}
                <hr>
            {% endunless %}
        {%- endfor -%}
    </div>
    <script type="application/json" id="variants-data-json">
      {{ product.variants | json }}
    </script>

    {%- comment -%} Size Guide Popup {%- endcomment -%}
    <dialog id="size-guide-popup" class="backdrop:bg-black/30 bg-transparent p-0 w-full max-w-sm rounded-xl">
        <div class="bg-secondary rounded-xl w-full max-h-[90vh] overflow-y-auto scrollbar-hidden relative">
            <button onclick="document.getElementById('size-guide-popup').close()" class="absolute z-10 top-3 right-3 bg-secondary-50 rounded-full p-2 hover:bg-main-10 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z"/>
                </svg>
            </button>
            <div id="size-guide-content" class="pb-8">
                {%- for size_option in product.metafields.painting_options.sizes.value -%}
                    <div class="size-guide-item hidden" data-size="{{ size_option.name }}">
                        {%- if size_option.popup.value.media.value.src -%}
                            <img
                                src="{{ size_option.popup.value.media.value.src | image_url: width: 500 }}"
                                alt="{{ size_option.popup.value.media.value.alt | escape }}"
                                width="500"
                                height="500"
                                loading="lazy"
                                class="w-full">
                        {%- endif -%}
                        {%- if size_option.popup.value.title -%}
                            <h4 class="my-8 text-xl px-8">{{ size_option.popup.value.title }}</h4>
                        {%- endif -%}
                        {%- if size_option.popup.value.description -%}
                            <div class="leading-loose text-main-90 px-8">
                                {{ size_option.popup.value.description }}
                            </div>
                        {%- endif -%}
                    </div>
                {%- endfor -%}
            </div>
        </div>
    </dialog>

    {%- comment -%} Border Guide Popup {%- endcomment -%}
    <dialog id="border-guide-popup" class="backdrop:bg-black/30 bg-transparent p-0 w-full max-w-sm rounded-xl">
        <div class="bg-secondary rounded-xl w-full max-h-[90vh] overflow-y-auto scrollbar-hidden relative">
            <button onclick="document.getElementById('border-guide-popup').close()" class="absolute z-10 top-3 right-3 bg-secondary-50 rounded-full p-2 hover:bg-main-10 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z"/>
                </svg>
            </button>
            <div id="border-guide-content" class="pb-8">
                {%- for border_option in product.metafields.painting_options.borders.value -%}
                    <div class="border-guide-item hidden" data-border="{{ border_option.name }}">
                        {%- if border_option.popup.value.media.value.src -%}
                            <img
                                src="{{ border_option.popup.value.media.value.src | image_url: width: 400 }}"
                                alt="{{ border_option.popup.value.media.value.alt | escape }}"
                                width="400"
                                height="400"
                                loading="lazy"
                                class="w-full">
                        {%- endif -%}
                        {%- if border_option.popup.value.title -%}
                            <h4 class="my-8 text-xl px-8">{{ border_option.popup.value.title }}</h4>
                        {%- endif -%}
                        {%- if border_option.popup.value.description -%}
                            <div class="leading-loose text-main-90 px-8">
                                {{ border_option.popup.value.description }}
                            </div>
                        {%- endif -%}
                    </div>
                {%- endfor -%}
            </div>
        </div>
    </dialog>

    {%- comment -%} Frame Guide Popup {%- endcomment -%}
    <dialog id="frame-guide-popup" class="backdrop:bg-black/30 bg-transparent p-0 w-full max-w-sm rounded-xl">
        <div class="bg-secondary rounded-xl w-full max-h-[90vh] overflow-y-auto scrollbar-hidden relative">
            <button onclick="document.getElementById('frame-guide-popup').close()" class="absolute z-10 top-3 right-3 bg-secondary-50 rounded-full p-2 hover:bg-main-10 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41z"/>
                </svg>
            </button>
            <div id="frame-guide-content" class="pb-8">
                {%- for frame_option in product.metafields.painting_options.frames_canvas.value -%}
                    <div class="frame-guide-item hidden" data-frame="{{ frame_option.name }}">
                        {%- if frame_option.popup.value.media.value.src -%}
                            <img
                                src="{{ frame_option.popup.value.media.value.src | image_url: width: 400 }}"
                                alt="{{ frame_option.popup.value.media.value.alt | escape }}"
                                width="400"
                                height="400"
                                loading="lazy"
                                class="w-full">
                        {%- endif -%}
                        {%- if frame_option.popup.value.title -%}
                            <h4 class="my-8 text-xl px-8">{{ frame_option.popup.value.title }}</h4>
                        {%- endif -%}
                        {%- if frame_option.popup.value.description -%}
                            <div class="leading-loose text-main-90 px-8">
                                {{ frame_option.popup.value.description }}
                            </div>
                        {%- endif -%}
                    </div>
                {%- endfor -%}
            </div>
        </div>
    </dialog>
{%- endunless -%}
  